<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctor Portal - Allograft Management</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div class="container">
      <h1>üë®‚Äç‚öïÔ∏è Doctor Portal</h1>
      <p>Algorithms 1 & 2: Add patients and donors to the system</p>
      <nav class="nav">
        <a href="index.html" class="home">üè† Home</a>
        <a href="workflow-guide.html">üìñ Workflow Guide</a>
        <a href="transplant-team.html">‚û°Ô∏è Next: Transplant Team</a>
        <a href="procurement-team.html">‚û°Ô∏è Next: Procurement Team</a>
        <a href="admin.html">Admin</a>
      </nav>
    </div>
  </header>

  <div class="container">
    <div class="workflow-steps">
      <h3>üìã Workflow Guide - Your Role:</h3>
      <ol>
        <li><span class="step-highlight">Step 1:</span> Add a patient who needs an organ</li>
        <li><span class="step-highlight">Step 2:</span> Add a donor who wants to donate</li>
        <li>After adding, the <strong>Transplant Team</strong> verifies patients</li>
        <li>The <strong>Procurement Team</strong> verifies donors</li>
        <li>Then the <strong>Matching Organizer</strong> matches compatible pairs</li>
      </ol>
    </div>

    <div class="wallet-info">
      <div>
        <strong>Connected Account:</strong> <span id="walletAddress">Not connected</span>
      </div>
      <button class="btn btn-primary" id="btnConnect">Connect Wallet</button>
    </div>

    <div class="grid-2">
      <!-- Add Patient -->
      <div class="card">
        <h2>Algorithm 1: Add Patient</h2>
        <form id="formAddPatient">
          <div class="form-group">
            <label>Patient ID</label>
            <input type="number" id="patientId" required>
          </div>
          <div class="form-group">
            <label>Age</label>
            <input type="number" id="patientAge" required>
          </div>
          <div class="form-group">
            <label>BMI</label>
            <input type="number" id="patientBMI" required>
          </div>
          <div class="form-group">
            <label>Blood Group</label>
            <select id="patientBloodGroup" required>
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>
          </div>
          <div class="form-group">
            <label>Organ Needed</label>
            <select id="patientOrgan" required>
              <option value="Kidney">Kidney</option>
              <option value="Liver">Liver</option>
              <option value="Heart">Heart</option>
              <option value="Lung">Lung</option>
              <option value="Pancreas">Pancreas</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Add Patient</button>
        </form>
      </div>

      <!-- Add Donor -->
      <div class="card">
        <h2>Algorithm 2: Add Donor</h2>
        <form id="formAddDonor">
          <div class="form-group">
            <label>Donor ID</label>
            <input type="number" id="donorId" required>
          </div>
          <div class="form-group">
            <label>Age</label>
            <input type="number" id="donorAge" required>
          </div>
          <div class="form-group">
            <label>BMI</label>
            <input type="number" id="donorBMI" required>
          </div>
          <div class="form-group">
            <label>Blood Group</label>
            <select id="donorBloodGroup" required>
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>
          </div>
          <div class="form-group">
            <label>Organ to Donate</label>
            <select id="donorOrgan" required>
              <option value="Kidney">Kidney</option>
              <option value="Liver">Liver</option>
              <option value="Heart">Heart</option>
              <option value="Lung">Lung</option>
              <option value="Pancreas">Pancreas</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success">Add Donor</button>
        </form>
      </div>
    </div>

    <!-- View Records -->
    <div class="card">
      <h2>View Patient/Donor Records</h2>
      <div class="form-group">
        <label>Enter ID to View</label>
        <input type="number" id="viewId">
      </div>
      <button class="btn btn-primary" id="btnViewPatient">View Patient</button>
      <button class="btn btn-success" id="btnViewDonor">View Donor</button>
      <div id="viewResult" style="margin-top:20px;"></div>
    </div>

    <div class="card">
      <h2>Activity Log</h2>
      <div class="log" id="log"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/web3@4.8.0/dist/web3.min.js"></script>
  <script src="common.js"></script>
  <script>
    document.getElementById('formAddPatient').onsubmit = async (e) => {
      e.preventDefault();
      const id = getNum('patientId');
      const age = getNum('patientAge');
      const bmi = getNum('patientBMI');
      const bloodGroup = getVal('patientBloodGroup');
      const organ = getVal('patientOrgan');
      
      await sendTransaction('addPatient', [id, age, bmi, bloodGroup, organ]);
      clearForm('formAddPatient');
    };

    document.getElementById('formAddDonor').onsubmit = async (e) => {
      e.preventDefault();
      const id = getNum('donorId');
      const age = getNum('donorAge');
      const bmi = getNum('donorBMI');
      const bloodGroup = getVal('donorBloodGroup');
      const organ = getVal('donorOrgan');
      
      await sendTransaction('addDonor', [id, age, bmi, bloodGroup, organ]);
      clearForm('formAddDonor');
    };

    document.getElementById('btnViewPatient').onclick = async () => {
      const id = getNum('viewId');
      if (!id) return log('Enter valid ID', 'error');
      
      const patient = await callView('patients', [id]);
      if (patient && patient.id != 0) {
        displayPatient(patient, 'viewResult');
      } else {
        document.getElementById('viewResult').innerHTML = 
          '<div class="alert alert-warning">Patient not found</div>';
      }
    };

    document.getElementById('btnViewDonor').onclick = async () => {
      const id = getNum('viewId');
      if (!id) return log('Enter valid ID', 'error');
      
      const donor = await callView('donors', [id]);
      if (donor && donor.id != 0) {
        displayDonor(donor, 'viewResult');
      } else {
        document.getElementById('viewResult').innerHTML = 
          '<div class="alert alert-warning">Donor not found</div>';
      }
    };
  </script>
</body>
</html>
